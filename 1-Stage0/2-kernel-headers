# llvmtools: Kernel Headers
# Build as cmlfs user

# If host uses clang instead of GCC, prefix each make 
# command with LLVM=1

# Build the headers
make mrproper
make ARCH=x86_64 headers

# Install the headers for stage 0 clang
sudo mkdir -pv /llvmtools/include && sudo chown -R cmlfs /llvmtools

# Stage1 clang expects headers in /llvmtools/usr/include
# May need a patch clang source to change that...
# o clang/lib/Driver/ToolChains/Linux.cpp
# o clang/lib/Driver/ToolChains/Gnu.cpp
# For now, create a link.
ln -sv . /llvmtools/usr

cp -rv usr/include/* /llvmtools/include/
find /llvmtools/usr/include -type f ! -name '*.h' -delete
rm -v /llvmtools/include/Makefile

# Clean the source
make mrproper
