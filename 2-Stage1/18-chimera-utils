# llvmtools: chimerautils
# Build as cmlfs
#
# NOTE: Replaces coreutils, diffutils, findutils, grep, sed, ed, m4, patch, bc,
#       gzip
# NOTE: Need musl-compat-headers, libxo, musl-fts, musl-rpmatch, libressl
#       installed in llvmtools.
#
# NOTE: Can be replaced by heirloom-ng to build less dependancies

# Apply patch a libreSSL does not support blake2b512 for EVP:
patch -Np1 -i ../patches/chimerautils-cmlfs/libressl-evp-noblake2b512-support.patch

CC=clang CXX=clang++ \
LD=ld.mold \
AR=llvm-ar AS=llvm-as \
RANLIB=llvm-ranlib STRIP=llvm-strip \
meson \
    --prefix=/llvmtools \
    --pkg-config-path /llvmtools/lib/pkgconfig \
    -Dcolor_ls=true \
    -Dopenssl=enabled \
    -Dlibedit=disabled \
    -Dzstd=disabled \
    build

# compile
ninja -C build

# Install to llvmtools
ninja -C build install