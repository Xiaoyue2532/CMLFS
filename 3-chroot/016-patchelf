# Stage1: Patchelf
# Build and install under chroot

# Setting the dynamic linker configuration option in Clang
# will cause static executables to segfault. As an alternative
# for setting the dynamic linker/linux-loader/interpreter, build
# patchelf to fix binaries until stage2 clang is built.

# Configure source to use LLVM's binary tools
CC=clang CXX=clang++ \
LD=ld.mold \
AR=llvm-ar AS=llvm-as \
RANLIB=llvm-ranlib STRIP=llvm-strip \
OBJCOPY=llvm-objcopy OBJDUMP=llvm-objdump \
./configure \
    --prefix=/llvmtools

# Build and install to llvmtools
make -j`nproc --all` && make install
