# Stage1: ccache 
# Build under chroot
# Optional package: Text editor for convenience or trouble shooting

mkdir build && cd build

cmake \
    -G Ninja -Wno-dev \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/llvmtools \
    -DCMAKE_INSTALL_SYSCONFDIR=/llvmtools/etc \
    -DCMAKE_C_COMPILER=clang \
    -DCMAKE_CXX_COMPILER=clang++ \
    -DHTTP_STORAGE_BACKEND=OFF \
    -DENABLE_TESTING=OFF \
    -DREDIS_STORAGE_BACKEND=OFF \
    ../

ninja && ninja install/strip

mkdir -pv /root/.bin

ln -sv /llvmtools/bin/ccache /root/.bin/clang
ln -sv /llvmtools/bin/ccache /root/.bin/clang++

export PATH=/root/.bin:$PATH
